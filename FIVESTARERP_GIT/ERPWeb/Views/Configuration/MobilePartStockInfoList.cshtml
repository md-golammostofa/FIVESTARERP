@model IEnumerable<ERPBO.Configuration.ViewModels.MobilePartStockInfoViewModel>
@{
    ViewBag.Title = "Parts Stock List";
}

<div class="row">
    <div class="col-md-12">
        <div class="card shadow card-primary card-outline card-tabs" style="margin-top:-20px">
            <div class="card-header p-0 pt-1 border-bottom-0 text-sm">
                <ul class="nav nav-tabs" id="custom-tabs-two-tab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="custom-tabs-two-partsStockIn-tab" data-toggle="pill" href="#custom-tabs-two-partsStockIn" role="tab" aria-controls="custom-tabs-two-partsStockIn" aria-selected="true">Parts Stock</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="custom-tabs-two-partsFalultyStock-tab" data-toggle="pill" href="#custom-tabs-two-partsFalultyStock" role="tab" aria-controls="custom-tabs-two-partsFalultyStock" aria-selected="true">Faulty Stock</a>
                    </li>
                    <li class="nav-item hide">
                        <a class="nav-link" id="custom-tabs-two-faultyStockRepairedList-tab" data-toggle="pill" href="#custom-tabs-two-faultyStockRepairedList" role="tab" aria-controls="custom-tabs-two-faultyStockRepairedList" aria-selected="true">Faulty Stock Repaired</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="custom-tabs-two-faultyStockScrapedList-tab" data-toggle="pill" href="#custom-tabs-two-faultyStockScrapedList" role="tab" aria-controls="custom-tabs-two-faultyStockScrapedList" aria-selected="true">Faulty Stock Scraped</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="custom-tabs-two-DustStockStockList-tab" data-toggle="pill" href="#custom-tabs-two-DustStockStockList" role="tab" aria-controls="custom-tabs-two-DustStockStockList" aria-selected="true">Dust Stock</a>
                    </li>
                </ul>
            </div>
            <div class="card-body shadow">
                <div class="tab-content" id="custom-tabs-two-tabContent">
                    @Html.AntiForgeryToken()
                    <div class="tab-pane fade show active" id="custom-tabs-two-partsStockIn" role="tabpanel" aria-labelledby="custom-tabs-two-partsStockIn-tab">
                        <div class="row" style="margin-top:-15px">
                            <div class="col-md-12">
                                <div class="card card-gray shadow">
                                    <div class="card-header">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <a href="/Configuration/MobilePartStockDetailList" style="background-color:darkblue" class="float-left btn btn-sm btn-outline-primary" title="Details View">
                                                    <i class="fas fa-eye"></i> Go To Details View
                                                </a>
                                            </div>
                                            <div class="col-md-6">
                                                <h5 class="text-center text-bold">
                                                    Parts Stock List
                                                </h5>
                                            </div>

                                            <div class="col-md-3">
                                                <a href="/Configuration/CreateMobilePartStock" class="btn btn-outline-primary btn-sm float-lg-right" id="btnAddNew"><i class="fa fa-plus"></i> Parts Stock-In</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12" style="margin-top:-15px">
                                <div class="card shadow card-navy">
                                    <div class="card-body text-sm">
                                        <div class="row text-sm">
                                            <div class="col-md-3 hide">
                                                <label for="ddlServicesWarehouse" class="control-label font-weight-bold">Services Warehouse Name</label>
                                                @Html.DropDownList("ddlServicesWarehouse", (IEnumerable<SelectListItem>)ViewBag.ddlServicesWarehouse, "--Select MobilePart--", new { @class = "form-control form-control-sm" })
                                            </div>
                                            <div class="col-md-2">
                                                <label for="ddlModels" class="control-label font-weight-bold">Model</label>
                                                @Html.DropDownList("ddlModels", (IEnumerable<SelectListItem>)ViewBag.ddlModels, "--Select Model--", new { @class = "form-control form-control-sm select select2" })
                                            </div>
                                            <div class="col-md-2">
                                                <label for="ddlMobilePart" class="control-label font-weight-bold">Parts Name</label>
                                                @Html.DropDownList("ddlMobilePart", (IEnumerable<SelectListItem>)ViewBag.ddlMobilePart, "--Select Parts--", new { @class = "form-control form-control-sm select select2" })
                                            </div>
                                            <div class="col-md-3">
                                                <label for="txtLessOrEq" class="control-label font-weight-bold">Qty (Less then / Equal)</label>
                                                <input type="number" id="txtLessOrEq" class="form-control form-control-sm" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12" style="margin-top:-10px">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-12 text-sm" id="dataContainer">
                                                @{Html.RenderAction("MobilePartStockInfoPartialList");}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade show " id="custom-tabs-two-partsFalultyStock" role="tabpanel" aria-labelledby="custom-tabs-two-partsFalultyStock-tab">
                        <div class="row" style="margin-top:-15px">
                            <div class="col-md-12">
                                <div class="card card-gray shadow">
                                    <div class="card-header">
                                        <div class="row">
                                            <div class="col-md-3">
                                                
                                            </div>
                                            <div class="col-md-6">
                                                <h5 class="text-center text-bold">
                                                    Faulty Stock List
                                                </h5>
                                            </div>
                                            <div class="col-md-3">
                                                <a href="/Configuration/CreateFaultyStock" style="background-color:darkblue" class="btn btn-outline-primary btn-sm float-lg-right" id="btnFaultyStockAssign"><i class="fa fa-plus"></i> Create Faulty Stock</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12" style="margin-top:-15px">
                                <div class="card shadow card-navy">
                                    <div class="card-body text-sm">
                                        <div class="row text-sm">
                                            <div class="col-md-3 hide">
                                                <label for="ddlFaultyServicesWarehouse" class="control-label font-weight-bold">Services Warehouse Name</label>
                                                @Html.DropDownList("ddlFaultyServicesWarehouse", (IEnumerable<SelectListItem>)ViewBag.ddlServicesWarehouse, "--Select MobilePart--", new { @class = "form-control form-control-sm" })
                                            </div>
                                            <div class="col-md-3">
                                                <label for="ddlFaultyModels" class="control-label font-weight-bold">Model</label>
                                                @Html.DropDownList("ddlFaultyModels", (IEnumerable<SelectListItem>)ViewBag.ddlModels, "--Select Model--", new { @class = "form-control form-control-sm select2" })
                                            </div>
                                            <div class="col-md-2">
                                                <label for="ddlFaultyMobilePart" class="control-label font-weight-bold">Parts Name</label>
                                                @Html.DropDownList("ddlFaultyMobilePart", (IEnumerable<SelectListItem>)ViewBag.ddlMobilePart, "--Select Parts--", new { @class = "form-control form-control-sm" })
                                            </div>
                                            <div class="col-md-3">
                                                <label for="txtLessOrEqFaulty" class="control-label font-weight-bold">Qty (Less then / Equal)</label>
                                                <input type="number" id="txtLessOrEqFaulty" class="form-control form-control-sm" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12" style="margin-top:-10px">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-12 text-sm" id="dataContainer2">
                                                @{ Html.RenderAction("MobilePartStockInfoList", new { flag = "FaultyStock" });}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade show " id="custom-tabs-two-faultyStockRepairedList" role="tabpanel" aria-labelledby="custom-tabs-two-faultyStockRepairedList-tab">
                        <div class="row" style="margin-top:-15px">
                            <div class="col-md-12">
                                <div class="card card-gray shadow">
                                    <div class="card-header">
                                        <div class="row">
                                            <div class="col-md-3">
                                            </div>
                                            <div class="col-md-6">
                                                <h5 class="text-center text-bold">
                                                    Faulty Stock Repaired List
                                                </h5>
                                            </div>
                                            <div class="col-md-3">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12" style="margin-top:-10px">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-12 text-sm">
                                                <button type="button" class="btn btn-outline-success btn-sm float-right" id="btnSaveFaultyRepaired"><i class="fas fa-paper-plane"></i> Receive</button>
                                            </div>
                                            <br />
                                            <br />
                                            <div class="col-md-12 text-sm" id="dataContainer3">
                                                @{ Html.RenderAction("MobilePartStockInfoList", new { flag = "FaultyStockRepaired" });}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade show " id="custom-tabs-two-faultyStockScrapedList" role="tabpanel" aria-labelledby="custom-tabs-two-faultyStockScrapedList-tab">
                        <div class="row" style="margin-top:-15px">
                            <div class="col-md-12">
                                <div class="card card-gray shadow">
                                    <div class="card-header">
                                        <div class="row">
                                            <div class="col-md-4">
                                            </div>
                                            <div class="col-md-4">
                                                <h5 class="text-center text-bold">
                                                    Faulty Stock Scraped List
                                                </h5>
                                            </div>
                                            <div class="col-md-4">
                                                <a href="/Configuration/CreateFaultyScraped" style="background-color:darkblue" class="btn btn-outline-primary btn-sm float-lg-right" id="btnFaultyStockScraped"><i class="fa fa-plus"></i> Create Scrap Stock</a>
                                                <a href="/Configuration/CreateDustStockTransfer" style="background-color:darkmagenta" class="btn btn-outline-primary btn-sm float-lg-right" id="btnDustStockTransfer"><i class="fa fa-plus"></i> Faulty Transfer</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12" style="margin-top:-10px">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-12 text-sm" id="dataContainer4">
                                                @{ Html.RenderAction("MobilePartStockInfoList", new { flag = "FaultyStockScrap" });}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade show " id="custom-tabs-two-DustStockStockList" role="tabpanel" aria-labelledby="custom-tabs-two-DustStockStockList-tab">
                        <div class="row" style="margin-top:-15px">
                            <div class="col-md-12">
                                <div class="card card-gray shadow">
                                    <div class="card-header">
                                        <div class="row">
                                            <div class="col-md-4">
                                            </div>
                                            <div class="col-md-4">
                                                <h5 class="text-center text-bold">
                                                    Dust Stock List
                                                </h5>
                                            </div>
                                            <div class="col-md-4">
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12" style="margin-top:-10px">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-12 text-sm" id="dataContainer5">
                                                @{ Html.RenderAction("MobilePartStockInfoList", new { flag = "DustStock" });}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@*<div class="row">
    <div class="col-md-12 text-center">
        <div class="card card-gray shadow">
            <div class="card-header">
                <div class="row">
                    <div class="col-md-3">
                        <a href="/Configuration/MobilePartStockDetailList" style="background-color:darkblue" class="float-left btn btn-sm btn-outline-primary" title="Details View">
                            <i class="fas fa-eye"></i> Go To Details View
                        </a>
                    </div>
                    <div class="col-md-6">
                        <h4><b>Parts Stock List</b></h4>
                    </div>
                    <div class="col-md-3">
                        <a href="/Configuration/CreateMobilePartStock" style="background-color:darkblue" class="btn btn-outline-primary btn-sm float-lg-right" id="btnAddNew"><i class="fa fa-plus"></i> Parts Stock-In</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="card shadow">
            <div class="card-header">
                <div class="col-md-12 mb-2">
                    @Html.AntiForgeryToken()
                    <div class="row text-sm">
                        <div class="col-md-3 hide">
                            <label for="ddlServicesWarehouse" class="control-label font-weight-bold">Services Warehouse Name</label>
                            @Html.DropDownList("ddlServicesWarehouse", (IEnumerable<SelectListItem>)ViewBag.ddlServicesWarehouse, "--Select MobilePart--", new { @class = "form-control form-control-sm" })
                        </div>
                        <div class="col-md-3">
                            <label for="ddlModels" class="control-label font-weight-bold">Model</label>
                            @Html.DropDownList("ddlModels", (IEnumerable<SelectListItem>)ViewBag.ddlModels, "--Select Model--", new { @class = "form-control form-control-sm select2" })
                        </div>
                        <div class="col-md-2">
                            <label for="ddlMobilePart" class="control-label font-weight-bold">Parts Name</label>
                            @Html.DropDownList("ddlMobilePart", (IEnumerable<SelectListItem>)ViewBag.ddlMobilePart, "--Select Parts--", new { @class = "form-control form-control-sm" })
                        </div>
                        <div class="col-md-2">
                            <label for="txtLessOrEq" class="control-label font-weight-bold">Qty (Less then / Equal)</label>
                            <input type="number" id="txtLessOrEq" class="form-control form-control-sm" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="card shadow">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12 text-sm" id="dataContainer">
                        @{Html.RenderAction("MobilePartStockInfoPartialList");}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>*@

@section scripts{
    <script type="text/javascript">
        var ddlServicesWarehouse = $("#ddlServicesWarehouse");
        var ddlModels = $("#ddlModels");
        var ddlMobilePart = $("#ddlMobilePart");
        var txtLessOrEq = $("#txtLessOrEq");
        //---Faulty Stock///
        var ddlFaultyServicesWarehouse = $("#ddlFaultyServicesWarehouse");
        var ddlFaultyModels = $("#ddlFaultyModels");
        var ddlFaultyMobilePart = $("#ddlFaultyMobilePart");
        var txtLessOrEqFaulty = $("#txtLessOrEqFaulty");

        var pageNo = 1;

        $(document).ready(function () {
            $('.select2').select2();
            $('.select2bs4').select2({
                theme: 'bootstrap4'
            });
        })
        ///Satock In
        ddlModels.change(function () {
            LoadDataTable();
        })
        ddlServicesWarehouse.change(function () {
            LoadDataTable();
        })
        ddlMobilePart.change(function () {
            LoadDataTable();
        })
        txtLessOrEq.keyup(function () {
            LoadDataTable();
        })

        function LoadDataTable() {
            var data = { flag: "search", SwerehouseId: TryParseInt(ddlServicesWarehouse.val(), 0), MobilePartId: TryParseInt(ddlMobilePart.val(), 0), modelId: TryParseInt(ddlModels.val(), 0), lessOrEq: txtLessOrEq.val(), page: pageNo };

            console.log(data);
            $.when(getReqWithData('html', 'GET', '/Configuration/MobilePartStockInfoPartialList', data)).then(function (res, status) {
                console.log(status);
                if (status === "success") {
                    $("#dataContainer").fadeOut('500', function () {
                        $("#dataContainer").empty();
                        $("#dataContainer").append(res).fadeIn('500');
                    });
                }
            }).fail(function (error) {
                console.log(error);
            })
            pageNo = 1;
        }
        // Pagination
        $(document).on('click', 'a.page-link', function (e) {
            e.preventDefault();
            if (!$(this).hasClass('current-page')) {
                if ($(this).parent().parents('div').hasClass('partsStock')) {
                    pageNo = $(this).attr('data-page-no');
                    LoadDataTable();
                }
            }
        })

        // Faulty Stock
        ddlFaultyModels.change(function () {
            LoadDataTableFaulty();
        })
        ddlFaultyServicesWarehouse.change(function () {
            LoadDataTableFaulty();
        })
        ddlFaultyMobilePart.change(function () {
            LoadDataTableFaulty();
        })
        txtLessOrEqFaulty.keyup(function () {
            LoadDataTableFaulty();
        })

        function LoadDataTableFaulty() {
            var data = { flag: "FaultyStock", SwerehouseId: TryParseInt(ddlFaultyServicesWarehouse.val(), 0), MobilePartId: TryParseInt(ddlFaultyMobilePart.val(), 0), modelId: TryParseInt(ddlFaultyModels.val(), 0), lessOrEq: txtLessOrEqFaulty.val(), page: pageNo };

            //console.log(data);
            $.when(getReqWithData('html', 'GET', '/Configuration/MobilePartStockInfoList', data)).then(function (res, status) {
                //console.log(status);
                if (status === "success") {
                    $("#dataContainer2").fadeOut('500', function () {
                        $("#dataContainer2").empty();
                        $("#dataContainer2").append(res).fadeIn('500');
                    });
                }
            }).fail(function (error) {
                console.log(error);
            })
            pageNo = 1;
        }
        // Pagination
        $(document).on('click', 'a.page-link', function (e) {
            e.preventDefault();
            if (!$(this).hasClass('current-page')) {
                if ($(this).parent().parents('div').hasClass('FaultyStock')) {
                    pageNo = $(this).attr('data-page-no');
                    LoadDataTableFaulty();
                }
            }
        })
        //Faulty Stock Repaired
        function LoadDataTableFaultyRepaired() {
            var data = { flag: "FaultyStockRepaired",page: pageNo };

            //console.log(data);
            $.when(getReqWithData('html', 'GET', '/Configuration/MobilePartStockInfoList', data)).then(function (res, status) {
                //console.log(status);
                if (status === "success") {
                    $("#dataContainer3").fadeOut('500', function () {
                        $("#dataContainer3").empty();
                        $("#dataContainer3").append(res).fadeIn('500');
                    });
                }
            }).fail(function (error) {
                console.log(error);
            })
            pageNo = 1;
        }
        // Pagination
        $(document).on('click', 'a.page-link', function (e) {
            e.preventDefault();
            if (!$(this).hasClass('current-page')) {
                if ($(this).parent().parents('div').hasClass('FaultyStockRepaired')) {
                    pageNo = $(this).attr('data-page-no');
                    LoadDataTableFaultyRepaired();
                }
            }
        })

        $(document).on('change', 'input[name="allItem"]', function () {
            var isChecked = $('input[name="allItem"]').is(":checked");
            $('input[name="item"]').prop("checked", isChecked);
            if (isChecked) {
                count = $(".tblFaultyStockRepaired tbody tr").length;
                $(".tblFaultyStockRepaired tbody tr").attr("data-item-row", "selected")
            }
            else {
                count = 0;
                $("input[type='number']").removeClass("error-border");
                $(".tblFaultyStockRepaired tbody tr").attr("data-item-row", "notSelected")
            }
        })

        $(document).on('change', 'input[name="item"]', function () {
            count = 0;
            $.each($(".tblFaultyStockRepaired tbody tr"), function (index, item) {
                if ($(this).children('td').eq(0).children('input[name="item"]').is(":checked")) {
                    count++;
                    $(this).attr("data-item-row", "selected");
                }
                else {
                    $(this).attr("data-item-row", "notSelected");
                }
            });
            var allChecked = $(".tblFaultyStockRepaired tbody tr").length == count;
            $('input[name="allItem"]').prop("checked", allChecked);
        })
        function validateSubmit() {
            var isValid = true;
            var totalCheckedItems = 0;
            var invalidValue = 0;
            if ($(".tblFaultyStockRepaired tbody").length > 0) {
                $.each($(".tblFaultyStockRepaired tbody tr"), function (index, item) {
                    if ($(this).children('td').eq(0).children('input[name="item"]').is(":checked")) {
                        totalCheckedItems++;
                    }
                });
                if (totalCheckedItems == 0) {
                    isValid = false;
                    toastr.error("Please checked at least one item", null, { timeOut: 1000 });
                }
            }
            else {
                toastr.error("Item Not Found", null, { timeOut: 1000 });
                isValid = false;
            }
            return isValid;
        }

        $("#btnSaveFaultyRepaired").click(function (e) {
            e.preventDefault();
            if (validateSubmit()) {
                bootbox.confirm("Are you sure you want to complete job?", function (result) {
                    if (result) {
                        disable("#btnSaveFaultyRepaired");
                        var selectedRows = $(".tblFaultyStockRepaired tbody tr[data-item-row='selected']");
                        var items = []; items.length = 0;
                        $.each(selectedRows, function (index, item) {
                            var tds = $(this).children('td');
                            items.push(
                                tds.eq('2').html(),
                            )
                        })

                        var data = JSON.stringify({ model: items });
                        $.when(postReqWithToken(dataType.applicationJson, dataType.json, type.post, '/Configuration/SaveFaultyStockRepairedItems', data, getToken())).then(function (res, status) {
                            if (res == true && status === "success") {
                                toastrSuccessAlert(execuStatus.successSave);
                                LoadDataTableFaultyRepaired();
                                LoadDataTableFaultyScrap();
                            }
                            else {
                                toastrErrorAlert(execuStatus.fail);
                            }
                            enable("#btnSaveFaultyRepaired");
                        }).fail(function (error) {
                            console.log(error);
                            toastrErrorAlert(execuStatus.fail);
                            enable("#btnSaveFaultyRepaired");
                        })
                    } // result
                }) // bootbox
            }// validate
        })

        //Faulty Stock Scraped
        function LoadDataTableFaultyScrap() {
            var data = { flag: "FaultyStockScrap", page: pageNo };

            //console.log(data);
            $.when(getReqWithData('html', 'GET', '/Configuration/MobilePartStockInfoList', data)).then(function (res, status) {
                //console.log(status);
                if (status === "success") {
                    $("#dataContainer4").fadeOut('500', function () {
                        $("#dataContainer4").empty();
                        $("#dataContainer4").append(res).fadeIn('500');
                    });
                }
            }).fail(function (error) {
                console.log(error);
            })
            pageNo = 1;
        }
        // Pagination
        $(document).on('click', 'a.page-link', function (e) {
            e.preventDefault();
            if (!$(this).hasClass('current-page')) {
                if ($(this).parent().parents('div').hasClass('FaultyStockScrap')) {
                    pageNo = $(this).attr('data-page-no');
                    LoadDataTableFaultyScrap();
                }
            }
        })
    </script>
    }